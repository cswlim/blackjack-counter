<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Blackjack Counter</title>
  <!-- Import Chart.js for the trend graph -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      -webkit-tap-highlight-color: transparent;
    }

    .app-container {
      position: relative; /* Needed for absolute positioning of reset button */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 1.5rem;
      box-sizing: border-box;
      text-align: center;
    }

    .reset-button {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background-color: #8e8e93;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .reset-button:hover {
      background-color: #a0a0a5;
    }

    .title {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #ffffff;
    }

    /* Main Counter Display */
    .counter-display {
      background-color: #1c1c1e;
      border-radius: 20px;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      width: 100%;
      max-width: 380px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .counter {
      font-size: 4.5rem;
      font-weight: bold;
      line-height: 1;
      color: #ffffff;
    }

    .counter-label {
      font-size: 1rem;
      color: #8e8e93;
      margin-bottom: 1rem;
    }

    .true-count {
      font-size: 1.5rem;
      font-weight: 600;
      color: #30d158;
    }

    /* Main Action Buttons */
    .buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      max-width: 380px;
      margin-bottom: 1.5rem;
    }

    .button {
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: 600;
      border: none;
      border-radius: 15px;
      color: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      cursor: pointer;
    }

    .button:active {
      transform: scale(0.97);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .button .hint {
      display: block;
      font-size: 1rem;
      font-weight: 400;
      opacity: 0.8;
      margin-top: 0.25rem;
    }

    .plus { background-color: #34c759; }
    .zero { background-color: #5856d6; }
    .minus { background-color: #ff3b30; }
    
    /* Stats Grids */
    .stats-container {
        width: 100%;
        max-width: 380px;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      background-color: #1c1c1e;
      padding: 1rem;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    .stats-grid h4 {
        grid-column: 1 / -1;
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
        color: #fff;
        text-align: left;
    }

    .stat-item { display: flex; flex-direction: column; }
    .stat-value { font-size: 1.5rem; font-weight: 600; color: #ffffff; }
    .stat-label { font-size: 0.8rem; color: #8e8e93; text-transform: uppercase; }
    
    /* Chart Section */
    .data-section {
      width: 100%;
      max-width: 380px;
      background: #1c1c1e;
      border-radius: 20px;
      padding: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      margin-bottom: 1.5rem;
    }
    .data-section h4 {
        margin: 0 0 1rem 0;
        font-size: 1.2rem;
        color: #fff;
        text-align: left;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <button class="reset-button" onclick="resetAll()">Reset</button>
    <div class="title">Advanced Blackjack Counter</div>

    <div class="counter-display">
      <div class="counter-label">Running Count</div>
      <div class="counter" id="running-count">0</div>
      <div class="true-count" id="true-count">True Count: 0.00</div>
    </div>

    <div class="buttons">
      <button class="button plus" onclick="handleCard(1)">+1 <span class="hint">Cards 2–6</span></button>
      <button class="button zero" onclick="handleCard(0)">0 <span class="hint">Cards 7–9</span></button>
      <button class="button minus" onclick="handleCard(-1)">-1 <span class="hint">10, J, Q, K, A</span></button>
    </div>

    <div class="stats-container">
        <!-- New Remaining Cards Grid -->
        <div class="stats-grid">
            <h4>Remaining Cards</h4>
            <div class="stat-item"><div class="stat-value" id="low-cards-left">120</div><div class="stat-label">Low (2-6)</div></div>
            <div class="stat-item"><div class="stat-value" id="neutral-cards-left">72</div><div class="stat-label">Neutral (7-9)</div></div>
            <div class="stat-item"><div class="stat-value" id="high-cards-left">120</div><div class="stat-label">High (10-A)</div></div>
        </div>
        <!-- Cards Played Grid -->
        <div class="stats-grid">
            <h4>Cards Played</h4>
            <div class="stat-item" style="grid-column: 1 / -1;"><div class="stat-value" id="cards-played">0 / 312</div><div class="stat-label">Total</div></div>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="data-section">
        <h4>Count Trends</h4>
        <canvas id="trend-chart"></canvas>
    </div>

  </div>

  <script>
    // --- STATE MANAGEMENT ---
    const TOTAL_DECKS = 6;
    const CARDS_PER_DECK = 52;
    const TOTAL_CARDS = TOTAL_DECKS * CARDS_PER_DECK;
    // Initial card counts for a 6-deck shoe
    const INITIAL_LOW_CARDS = 5 * 4 * TOTAL_DECKS;  // 120
    const INITIAL_NEUTRAL_CARDS = 3 * 4 * TOTAL_DECKS; // 72
    const INITIAL_HIGH_CARDS = 5 * 4 * TOTAL_DECKS; // 120

    // Core State
    let runningCount = 0;
    let cardsPlayed = 0;
    
    // **FIXED**: State for tracking played cards by type
    let lowCardsPlayed = 0;
    let neutralCardsPlayed = 0;
    let highCardsPlayed = 0;

    let trendData = []; // Store data for the chart
    let trendChart;

    // --- DOM ELEMENTS ---
    const runningCountEl = document.getElementById("running-count");
    const trueCountEl = document.getElementById("true-count");
    const cardsPlayedEl = document.getElementById("cards-played");
    const lowCardsLeftEl = document.getElementById("low-cards-left");
    const neutralCardsLeftEl = document.getElementById("neutral-cards-left");
    const highCardsLeftEl = document.getElementById("high-cards-left");
    const chartCanvas = document.getElementById('trend-chart').getContext('2d');

    // --- CORE LOGIC ---
    function handleCard(value) {
      if (cardsPlayed >= TOTAL_CARDS) {
        console.warn("Shoe is finished. Please reset.");
        return;
      }
      
      // **FIXED**: Increment the correct played card counter
      if (value === 1) lowCardsPlayed++;
      else if (value === 0) neutralCardsPlayed++;
      else if (value === -1) highCardsPlayed++;

      runningCount += value;
      cardsPlayed++;
      
      // Add data point for the chart using the latest data
      trendData.push({
          rc: runningCount,
          tc: calculateTrueCount()
      });

      updateDisplay();
      updateChart();
    }

    function calculateTrueCount() {
      const cardsRemaining = TOTAL_CARDS - cardsPlayed;
      if (cardsRemaining === 0) return 0;
      const decksRemaining = cardsRemaining / CARDS_PER_DECK;
      return runningCount / decksRemaining;
    }

    function updateDisplay() {
      // Update main counts
      runningCountEl.innerText = runningCount;
      const trueCount = calculateTrueCount();
      trueCountEl.innerText = `True Count: ${trueCount.toFixed(2)}`;
      
      // Update true count color
      if (trueCount >= 2) trueCountEl.style.color = '#34c759';
      else if (trueCount <= -1) trueCountEl.style.color = '#ff3b30';
      else trueCountEl.style.color = '#e0e0e0';
      
      // Update total cards played count
      cardsPlayedEl.innerText = `${cardsPlayed} / ${TOTAL_CARDS}`;
      
      // **FIXED**: Update remaining cards count with correct logic
      lowCardsLeftEl.innerText = INITIAL_LOW_CARDS - lowCardsPlayed;
      neutralCardsLeftEl.innerText = INITIAL_NEUTRAL_CARDS - neutralCardsPlayed;
      highCardsLeftEl.innerText = INITIAL_HIGH_CARDS - highCardsPlayed;
    }
    
    // --- CHART LOGIC ---
    function updateChart() {
        trendChart.data.labels = trendData.map((_, index) => index + 1);
        trendChart.data.datasets[0].data = trendData.map(d => d.rc);
        trendChart.data.datasets[1].data = trendData.map(d => d.tc);
        trendChart.update('none'); // 'none' for no animation
    }

    function setupChart() {
        trendChart = new Chart(chartCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Running Count',
                    data: [],
                    borderColor: '#ffffff',
                    backgroundColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 2,
                    tension: 0.2,
                    pointRadius: 0
                }, {
                    label: 'True Count',
                    data: [],
                    borderColor: '#34c759',
                    backgroundColor: 'rgba(52, 199, 89, 0.1)',
                    borderWidth: 2,
                    tension: 0.2,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                animation: { duration: 0 },
                scales: {
                    y: { beginAtZero: false, ticks: { color: '#8e8e93' }, grid: { color: '#3a3a3c' } },
                    x: { ticks: { color: '#8e8e93', maxTicksLimit: 10 }, grid: { display: false } }
                },
                plugins: {
                    legend: { labels: { color: '#e0e0e0' } }
                }
            }
        });
    }

    function resetAll() {
      // Reset core state
      runningCount = 0;
      cardsPlayed = 0;
      
      // **FIXED**: Reset played card counters
      lowCardsPlayed = 0;
      neutralCardsPlayed = 0;
      highCardsPlayed = 0;
      
      // Reset chart data
      trendData = [];
      
      // Update the entire UI
      updateDisplay();
      updateChart();
      
      console.log("Counter and history have been reset.");
    }

    // --- INITIALIZATION ---
    window.onload = () => {
      setupChart();
      updateDisplay();
    };
  </script>
</body>
</html>
